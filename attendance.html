<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Attendance Management - Interns Tracker</title>
  <link rel="stylesheet" href="./css/attendance.css">
  <style>
    /* Additional styles for the new sidebar navigation */
    .sidebar-nav {
      margin-bottom: 24px;
    }
    
    .sidebar-nav-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      color: #4a5568;
      text-decoration: none;
      border-radius: 6px;
      margin-bottom: 4px;
      transition: all 0.2s ease;
    }
    
    .sidebar-nav-item:hover {
      background-color: #edf2f7;
      color: #2d3748;
    }
    
    .sidebar-nav-item.active {
      background-color: #ebf8ff;
      color: #3182ce;
      font-weight: 500;
    }
    
    .sidebar-nav-icon {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      stroke: currentColor;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
    }
    
    .sidebar-nav-text {
      font-size: 14px;
    }
    
    .sidebar-title {
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 12px;
      display: block;
    }
    
    .sidebar-card {
      background: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    }
  </style>
</head>
<body>
  <!-- Offline-style Header -->
  <div class="topbar">
    <div class="topbar-left">
      <button class="back-btn" id="backBtn" title="Go back">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Back
      </button>
      <div class="topbar-logo">
        <img src="images/sic logo.jpg" alt="Company Logo" class="topbar-logo-img">
        <span class="topbar-title">Attendance System</span>
      </div>
    </div>
  </div>

  <!-- Main Container -->
  <div class="container">
    <!-- Sidebar with Navigation Menu -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <a href="index.html" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
          <span class="sidebar-nav-text">Dashboard</span>
        </a>
        <a href="index.html" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          <span class="sidebar-nav-text">Intern</span>
        </a>
        <a href="#" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
          <span class="sidebar-nav-text">Attendance</span>
        </a>
        <a href="report.html" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>
          <span class="sidebar-nav-text">Reports</span>
        </a>
        <a href="settings.html" class="sidebar-nav-item">
          <svg class="sidebar-nav-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2h-.09a1.65 1.65 0 0 0-1.51 1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-1.82-.33l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
          <span class="sidebar-nav-text">Settings</span>
        </a>
      </nav>

      <!-- Quick Actions Card -->
      <div class="sidebar-card">
        <h3 class="sidebar-title">Quick Actions</h3>
        <button class="btn btn-primary" style="width: 100%; margin-bottom: 8px;" id="markAttendanceBtn">Mark Attendance</button>
        <button class="btn btn-outline" style="width: 100%; margin-bottom: 8px;" id="requestLeaveBtn">Request Leave</button>
        <button class="btn btn-outline" style="width: 100%;" id="submitComplianceBtn">Submit Compliance</button>
      </div>
      
      <!-- Reports Card -->
      <div class="sidebar-card">
        <h3 class="sidebar-title">Reports</h3>
        <button class="btn btn-primary" style="width: 100%; margin-bottom: 8px;" id="printWeeklyBtn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect>
          </svg>
          Print Weekly
        </button>
        <button class="btn btn-primary" style="width: 100%;" id="printMonthlyBtn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect>
          </svg>
          Print Monthly
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Attendance Section -->
      <div class="attendance-section">
        <div class="section-header">
          <h2 class="section-title">Attendance Records</h2>
          <div class="view-options">
            <button class="view-btn active" data-view="daily">Daily</button>
            <button class="view-btn" data-view="weekly">Weekly</button>
            <button class="view-btn" data-view="monthly">Monthly</button>
            <button class="print-btn" id="printCurrentView">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect>
              </svg>
              Print
            </button>
          </div>
        </div>

        <!-- Daily View (Default) -->
        <div class="view-content" id="dailyView">
          <table class="attendance-table" id="dailyAttendanceTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Check-in</th>
                <th>Check-out</th>
                <th>Hours</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be populated by JavaScript -->
            </tbody>
          </table>
        </div>

        <!-- Weekly View (Hidden by default) -->
        <div class="view-content" id="weeklyView" style="display: none;">
          <div style="margin-bottom: 16px;">
            <select class="form-select" id="weekSelector" style="width: 200px; display: inline-block;">
              <option value="current">Current Week</option>
              <option value="previous1">Previous Week</option>
              <option value="previous2">2 Weeks Ago</option>
            </select>
          </div>
          <table class="attendance-table" id="weeklyAttendanceTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Total Hours</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be populated by JavaScript -->
            </tbody>
          </table>
        </div>

        <!-- Monthly View (Hidden by default) -->
        <div class="view-content" id="monthlyView" style="display: none;">
          <div style="margin-bottom: 16px;">
            <select class="form-select" id="monthSelector" style="width: 200px; display: inline-block;">
              <option value="current">Current Month</option>
              <option value="previous1">Previous Month</option>
              <option value="previous2">2 Months Ago</option>
            </select>
          </div>
          <table class="calendar" id="monthlyCalendar">
            <thead>
              <tr>
                <th>Sun</th>
                <th>Mon</th>
                <th>Tue</th>
                <th>Wed</th>
                <th>Thu</th>
                <th>Fri</th>
                <th>Sat</th>
              </tr>
            </thead>
            <tbody>
              <!-- Calendar will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav">
    <a href="index.html" class="mobile-nav-item">
      <svg class="mobile-nav-icon" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
      <span>Home</span>
    </a>
    <a href="attendance.html" class="mobile-nav-item active">
      <svg class="mobile-nav-icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
      <span>Time</span>
    </a>
    <a href="leave.html" class="mobile-nav-item">
      <svg class="mobile-nav-icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
      <span>Leave</span>
    </a>
    <a href="reports.html" class="mobile-nav-item">
      <svg class="mobile-nav-icon" viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>
      <span>Reports</span>
    </a>
  </nav>

  <!-- Mark Attendance Modal -->
  <div class="modal" id="markAttendanceModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Mark Attendance</div>
        <button class="modal-close" id="closeMarkAttendance">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Employee</label>
          <select class="form-select" id="attendanceEmployee">
            <option value="">Select employee</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Date</label>
          <input type="date" class="form-control" id="attendanceDate">
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <select class="form-select" id="attendanceStatus">
            <option value="present">Present</option>
            <option value="absent">Absent</option>
            <option value="late">Late</option>
            <option value="leave">On Leave</option>
          </select>
        </div>
        <div class="form-group" id="checkinTimeGroup">
          <label class="form-label">Check-in Time</label>
          <input type="time" class="form-control" id="checkinTime">
        </div>
        <div class="form-group" id="checkoutTimeGroup">
          <label class="form-label">Check-out Time</label>
          <input type="time" class="form-control" id="checkoutTime">
        </div>
        <div class="form-group">
          <label class="form-label">Remarks</label>
          <textarea class="form-control" id="attendanceRemarks" rows="3" placeholder="Optional notes"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="cancelMarkAttendance">Cancel</button>
        <button class="btn btn-primary" id="submitAttendance">Submit</button>
      </div>
    </div>
  </div>

  <!-- Request Leave Modal -->
  <div class="modal" id="requestLeaveModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Request Leave</div>
        <button class="modal-close" id="closeRequestLeave">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Leave Type</label>
          <select class="form-select" id="leaveType">
            <option>Vacation</option>
            <option>Sick Leave</option>
            <option>Personal Day</option>
            <option>Bereavement</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Start Date</label>
          <input type="date" class="form-control" id="leaveStartDate">
        </div>
        <div class="form-group">
          <label class="form-label">End Date</label>
          <input type="date" class="form-control" id="leaveEndDate">
        </div>
        <div class="form-group">
          <label class="form-label">Reason</label>
          <textarea class="form-control" id="leaveReason" rows="3" placeholder="Brief reason for leave"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Attachment (if any)</label>
          <input type="file" class="form-control" id="leaveAttachment">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="cancelRequestLeave">Cancel</button>
        <button class="btn btn-primary" id="submitLeaveRequest">Submit Request</button>
      </div>
    </div>
  </div>

  <!-- Submit Compliance Modal -->
  <div class="modal" id="submitComplianceModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Submit Compliance</div>
        <button class="modal-close" id="closeSubmitCompliance">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Compliance Type</label>
          <select class="form-select" id="complianceType">
            <option>Monthly Attendance Report</option>
            <option>Labor Law Compliance</option>
            <option>Work Hours Audit</option>
            <option>Leave Balance Report</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Period</label>
          <select class="form-select" id="compliancePeriod">
            <option>July 2025</option>
            <option>June 2025</option>
            <option>May 2025</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Document</label>
          <input type="file" class="form-control" id="complianceDocument">
        </div>
        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-control" id="complianceNotes" rows="3" placeholder="Any additional information"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="cancelSubmitCompliance">Cancel</button>
        <button class="btn btn-primary" id="submitCompliance">Submit</button>
      </div>
    </div>
  </div>

  <script>
    // Sample employee data
    const employees = [
      { id: 1, name: "Melissa Eshun" },
      { id: 2, name: "Rahim Alhassan" },
      { id: 3, name: "Joyce Osei" },
      { id: 4, name: "Bismark Issah" },
      { id: 5, name: "Kwame Mensah" }
    ];

    // Attendance data storage
    let attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];

    // Back button functionality
    document.getElementById('backBtn').addEventListener('click', function() {
      window.history.back();
    });

    // Initialize the app
    function initApp() {
      // Set today's date in date pickers
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('attendanceDate').value = today;
      document.getElementById('leaveStartDate').value = today;
      document.getElementById('leaveEndDate').value = today;
      
      // Populate employee dropdown
      const employeeSelect = document.getElementById('attendanceEmployee');
      employees.forEach(employee => {
        const option = document.createElement('option');
        option.value = employee.id;
        option.textContent = employee.name;
        employeeSelect.appendChild(option);
      });
      
      // Load initial data
      loadDailyAttendance();
      loadWeeklyAttendance();
      loadMonthlyCalendar();
    }

    // Load daily attendance data
    function loadDailyAttendance() {
      const today = new Date().toISOString().split('T')[0];
      const tbody = document.querySelector('#dailyAttendanceTable tbody');
      tbody.innerHTML = '';
      
      employees.forEach(employee => {
        const row = document.createElement('tr');
        const employeeAttendance = attendanceData.find(a => 
          a.employeeId === employee.id && a.date === today
        ) || { status: 'absent', checkIn: '', checkOut: '', hours: 0 };
        
        row.innerHTML = `
          <td>${employee.name}</td>
          <td><span class="status-badge status-${employeeAttendance.status}">${
            employeeAttendance.status.charAt(0).toUpperCase() + employeeAttendance.status.slice(1)
          }</span></td>
          <td>${employeeAttendance.checkIn || '-'}</td>
          <td>${employeeAttendance.checkOut || '-'}</td>
          <td>${employeeAttendance.hours ? employeeAttendance.hours.toFixed(2) : '0.00'}</td>
          <td>
            <button class="edit-btn" data-id="${employee.id}">Edit</button>
          </td>
        `;
        tbody.appendChild(row);
      });
      
      // Add event listeners to edit buttons
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const employeeId = parseInt(this.dataset.id);
          const employee = employees.find(e => e.id === employeeId);
          const today = new Date().toISOString().split('T')[0];
          const attendance = attendanceData.find(a => 
            a.employeeId === employeeId && a.date === today
          ) || { status: 'absent', checkIn: '', checkOut: '', hours: 0 };
          
          // Fill the form with existing data
          document.getElementById('attendanceEmployee').value = employeeId;
          document.getElementById('attendanceDate').value = today;
          document.getElementById('attendanceStatus').value = attendance.status;
          document.getElementById('checkinTime').value = attendance.checkIn || '09:00';
          document.getElementById('checkoutTime').value = attendance.checkOut || '17:00';
          document.getElementById('attendanceRemarks').value = attendance.remarks || '';
          
          // Show the modal
          document.getElementById('markAttendanceModal').classList.add('open');
        });
      });
    }

    // Load weekly attendance data
    function loadWeeklyAttendance() {
      const tbody = document.querySelector('#weeklyAttendanceTable tbody');
      tbody.innerHTML = '';
      
      // This is a simplified version - in a real app you would calculate based on actual data
      employees.forEach(employee => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${employee.name}</td>
          <td><span class="status-badge status-present">9.5h</span></td>
          <td><span class="status-badge status-present">8.0h</span></td>
          <td><span class="status-badge status-absent">0h</span></td>
          <td><span class="status-badge status-present">9.0h</span></td>
          <td><span class="status-badge status-present">9.25h</span></td>
          <td>35.75h</td>
        `;
        tbody.appendChild(row);
      });
    }

    // Load monthly calendar
    function loadMonthlyCalendar() {
      const tbody = document.querySelector('#monthlyCalendar tbody');
      tbody.innerHTML = '';
      
      // Get current date
      const currentDate = new Date();
      const currentYear = currentDate.getFullYear();
      const currentMonth = currentDate.getMonth();
      
      // Get first day of month and total days in month
      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      
      // Create calendar rows
      let date = 1;
      for (let i = 0; i < 6; i++) {
        // Stop if we've processed all days
        if (date > daysInMonth) break;
        
        const row = document.createElement('tr');
        
        // Create cells for each day of week
        for (let j = 0; j < 7; j++) {
          const cell = document.createElement('td');
          
          if (i === 0 && j < firstDay) {
            // Empty cells before first day of month
            cell.textContent = '';
          } else if (date > daysInMonth) {
            // Empty cells after last day of month
            cell.textContent = '';
          } else {
            // Day of month
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = date;
            
            // Highlight today
            if (date === currentDate.getDate() && currentMonth === currentDate.getMonth()) {
              dayElement.classList.add('today');
            }
            
            // Add attendance status if available
            const attendanceForDay = attendanceData.find(a => {
              const d = new Date(a.date);
              return d.getDate() === date && d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            });
            
            if (attendanceForDay) {
              dayElement.classList.add('has-attendance', attendanceForDay.status);
            }
            
            cell.appendChild(dayElement);
            date++;
          }
          
          row.appendChild(cell);
        }
        
        tbody.appendChild(row);
      }
    }

    // View switching
    const viewBtns = document.querySelectorAll('.view-btn');
    viewBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        // Remove active class from all view buttons
        viewBtns.forEach(b => b.classList.remove('active'));
        // Add active class to clicked button
        this.classList.add('active');
        
        // Hide all views
        document.querySelectorAll('.view-content').forEach(view => {
          view.style.display = 'none';
        });
        
        // Show the selected view
        const viewId = this.dataset.view + 'View';
        document.getElementById(viewId).style.display = 'block';
      });
    });

    // Print functionality
    document.getElementById('printCurrentView').addEventListener('click', function() {
      window.print();
    });

    document.getElementById('printWeeklyBtn').addEventListener('click', function() {
      // Switch to weekly view and print
      document.querySelector('.view-btn[data-view="weekly"]').click();
      setTimeout(() => {
        window.print();
      }, 100);
    });

    document.getElementById('printMonthlyBtn').addEventListener('click', function() {
      // Switch to monthly view and print
      document.querySelector('.view-btn[data-view="monthly"]').click();
      setTimeout(() => {
        window.print();
      }, 100);
    });

    // Modal handling
    const markAttendanceModal = document.getElementById('markAttendanceModal');
    const requestLeaveModal = document.getElementById('requestLeaveModal');
    const submitComplianceModal = document.getElementById('submitComplianceModal');

    // Open modals
    document.getElementById('markAttendanceBtn').addEventListener('click', () => {
      // Reset form
      document.getElementById('attendanceEmployee').value = '';
      document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
      document.getElementById('attendanceStatus').value = 'present';
      document.getElementById('checkinTime').value = '09:00';
      document.getElementById('checkoutTime').value = '17:00';
      document.getElementById('attendanceRemarks').value = '';
      
      markAttendanceModal.classList.add('open');
    });
    document.getElementById('requestLeaveBtn').addEventListener('click', () => {
      requestLeaveModal.classList.add('open');
    });
    document.getElementById('submitComplianceBtn').addEventListener('click', () => {
      submitComplianceModal.classList.add('open');
    });

    // Close modals
    document.getElementById('closeMarkAttendance').addEventListener('click', () => {
      markAttendanceModal.classList.remove('open');
    });
    document.getElementById('closeRequestLeave').addEventListener('click', () => {
      requestLeaveModal.classList.remove('open');
    });
    document.getElementById('closeSubmitCompliance').addEventListener('click', () => {
      submitComplianceModal.classList.remove('open');
    });

    document.getElementById('cancelMarkAttendance').addEventListener('click', () => {
      markAttendanceModal.classList.remove('open');
    });
    document.getElementById('cancelRequestLeave').addEventListener('click', () => {
      requestLeaveModal.classList.remove('open');
    });
    document.getElementById('cancelSubmitCompliance').addEventListener('click', () => {
      submitComplianceModal.classList.remove('open');
    });

    // Submit attendance
    document.getElementById('submitAttendance').addEventListener('click', function() {
      const employeeId = parseInt(document.getElementById('attendanceEmployee').value);
      const date = document.getElementById('attendanceDate').value;
      const status = document.getElementById('attendanceStatus').value;
      const checkIn = document.getElementById('checkinTime').value;
      const checkOut = document.getElementById('checkoutTime').value;
      const remarks = document.getElementById('attendanceRemarks').value;
      
      // Calculate hours worked
      let hours = 0;
      if (checkIn && checkOut && status === 'present') {
        const [inHours, inMinutes] = checkIn.split(':').map(Number);
        const [outHours, outMinutes] = checkOut.split(':').map(Number);
        hours = (outHours + outMinutes/60) - (inHours + inMinutes/60);
      }
      
      // Find existing record or create new one
      const existingIndex = attendanceData.findIndex(a => 
        a.employeeId === employeeId && a.date === date
      );
      
      if (existingIndex >= 0) {
        // Update existing record
        attendanceData[existingIndex] = {
          employeeId, date, status, checkIn, checkOut, hours, remarks
        };
      } else {
        // Add new record
        attendanceData.push({
          employeeId, date, status, checkIn, checkOut, hours, remarks
        });
      }
      
      // Save to localStorage
      localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
      
      // Reload data
      loadDailyAttendance();
      loadWeeklyAttendance();
      loadMonthlyCalendar();
      
      // Close modal
      markAttendanceModal.classList.remove('open');
      
      // Show success message
      alert('Attendance recorded successfully!');
    });

    // Toggle time inputs based on status
    document.getElementById('attendanceStatus').addEventListener('change', function() {
      const status = this.value;
      const showTimes = status === 'present' || status === 'late';
      
      document.getElementById('checkinTimeGroup').style.display = showTimes ? 'block' : 'none';
      document.getElementById('checkoutTimeGroup').style.display = showTimes ? 'block' : 'none';
    });

    // Submit leave request
    document.getElementById('submitLeaveRequest').addEventListener('click', function() {
      const leaveType = document.getElementById('leaveType').value;
      const startDate = document.getElementById('leaveStartDate').value;
      const endDate = document.getElementById('leaveEndDate').value;
      const reason = document.getElementById('leaveReason').value;
      
      // Here you would typically send this data to your backend
      console.log('Leave Request Submitted:', {
        leaveType,
        startDate,
        endDate,
        reason
      });
      
      alert('Leave request submitted successfully!');
      requestLeaveModal.classList.remove('open');
    });

    // Submit compliance
    document.getElementById('submitCompliance').addEventListener('click', function() {
      const complianceType = document.getElementById('complianceType').value;
      const period = document.getElementById('compliancePeriod').value;
      const notes = document.getElementById('complianceNotes').value;
      
      // Here you would typically send this data to your backend
      console.log('Compliance Submitted:', {
        complianceType,
        period,
        notes
      });
      
      alert('Compliance submitted successfully!');
      submitComplianceModal.classList.remove('open');
    });

    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target === markAttendanceModal) {
        markAttendanceModal.classList.remove('open');
      }
      if (e.target === requestLeaveModal) {
        requestLeaveModal.classList.remove('open');
      }
      if (e.target === submitComplianceModal) {
        submitComplianceModal.classList.remove('open');
      }
    });

    // Escape key to close modals
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        markAttendanceModal.classList.remove('open');
        requestLeaveModal.classList.remove('open');
        submitComplianceModal.classList.remove('open');
      }
    });

    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>